{% extends 'main_app/main_base.html' %}
{% load static %}

{% block title %}LeafAI - PhÃ¢n tÃ­ch lÃ¡{% endblock %}

{% block content %}
<link rel="stylesheet" href="{% static 'main_app/css/dashboard.css' %}">
<script src="{% static 'main_app/js/dashboard.js' %}"></script>

<div class="dashboard-container">
  <h2 class="title">ğŸ“Š Dashboard</h2>

  <!-- Upload Form -->
  <section class="upload-box">
    <h3>Táº£i áº£nh Ä‘á»ƒ dá»± Ä‘oÃ¡n</h3>
    <form method="post" enctype="multipart/form-data" class="upload-form">
      {% csrf_token %}
      <!-- chá»n file tá»« mÃ¡y -->
      <input type="file" name="image" id="imageInput" accept="image/*" capture="environment">
      <button type="submit" class="btn">ğŸš€ Dá»± Ä‘oÃ¡n</button>
    </form>

    <hr>

    <!-- Camera -->
     <div class="camera-box">
  <button type="button" id="startCamera" class="btn">ğŸ“· Má»Ÿ camera</button>
  <video id="camera" autoplay playsinline style="display:none; width:300px; border:1px solid #ddd; margin-top:10px;"></video>
  <button type="button" id="captureBtn" class="btn" style="display:none; margin-top:10px;">ğŸ“¸ Chá»¥p áº£nh</button>
  <canvas id="canvas" style="display:none;"></canvas>
  </div>

  <form method="post" enctype="multipart/form-data" id="cameraForm">
    {% csrf_token %}
    <input type="hidden" name="captured_image" id="capturedImage">
    <button type="submit" class="btn">ğŸš€ Dá»± Ä‘oÃ¡n áº£nh chá»¥p</button>
  </form>

  </section>

  <!-- Káº¿t quáº£ má»›i nháº¥t -->
  {% if history_list %}
    <div class="result-box">
        <h3>Káº¿t quáº£ dá»± Ä‘oÃ¡n má»›i nháº¥t:</h3>
        <p><b>Bá»‡nh:</b> <span class="highlight">{{ history_list.0.predicted_class }}</span></p>
        <p><b>XÃ¡c suáº¥t:</b> <span class="highlight">{{ history_list.0.probability }}%</span></p>
        <div class="preview">
            <img src="data:image/png;base64,{{ history_list.0.image_base64 }}" class="result-img">
        </div>
    </div>
  {% endif %}
 <section id="history">
  <h3>Lá»‹ch sá»­ dá»± Ä‘oÃ¡n</h3>

  {% if history_list %}
    <div class="table-container">
      <table>
        <thead>
          <tr>
            <th>áº¢nh</th>
            <th>Káº¿t quáº£</th>
            <th>XÃ¡c suáº¥t</th>
            <th>Thá»i gian</th>
            <th>HÃ nh Ä‘á»™ng</th>  <!-- ğŸ‘ˆ thÃªm cá»™t hÃ nh Ä‘á»™ng -->
          </tr>
        </thead>
        <tbody>
        {% for h in history_list %}
          <tr>
            <td><img src="data:image/png;base64,{{ h.image_base64 }}" class="thumb"></td>
            <td>{{ h.predicted_class }}</td>
            <td>{{ h.probability }}%</td>
            <td>{{ h.created_at }}</td>
            <td>
              <!-- NÃºt xoÃ¡ -->
              <form method="post" style="display:inline;">
                {% csrf_token %}
                <input type="hidden" name="action" value="delete_one">
                <input type="hidden" name="record_id" value="{{ h.id }}">
                <button type="submit" class="btn btn-danger" onclick="return confirm('Báº¡n cÃ³ cháº¯c muá»‘n xÃ³a dá»± Ä‘oÃ¡n nÃ y?')">
                  ğŸ—‘ XÃ³a
                </button>
              </form>
            </td>
          </tr>
        {% endfor %}
        </tbody>
      </table>
    </div>
  {% else %}
    <p class="empty">ChÆ°a cÃ³ lá»‹ch sá»­ dá»± Ä‘oÃ¡n nÃ o.</p>
  {% endif %}
</section>

</div>
{% endblock %}


